report 50137 "Allocations Master Report"
{
    DefaultLayout = RDLC;
    RDLCLayout = 'src/Layouts/Allocations Master Report.rdl';

    dataset
    {
        dataitem(Customer; Customer)
        {
            column(No; "No.")
            {
            }
            column(Name; Name)
            {
            }
            column(TransAmnts1; TransAmnts[1])
            {
            }
            column(TransAmnts2; TransAmnts[2])
            {
            }
            column(TransAmnts3; TransAmnts[3])
            {
            }
            column(TransAmnts4; TransAmnts[4])
            {
            }
            column(TransAmnts5; TransAmnts[5])
            {
            }
            column(TransAmnts6; TransAmnts[6])
            {
            }
            column(TransAmnts7; TransAmnts[7])
            {
            }
            column(TransAmnts8; TransAmnts[8])
            {
            }
            column(TransAmnts9; TransAmnts[9])
            {
            }
            column(TransAmnts10; TransAmnts[10])
            {
            }
            column(TransAmnts11; TransAmnts[11])
            {
            }
            column(TransAmnts12; TransAmnts[12])
            {
            }
            column(TransAmnts13; TransAmnts[13])
            {
            }
            column(TransAmnts14; TransAmnts[14])
            {
            }
            column(TransAmnts15; TransAmnts[15])
            {
            }
            column(TransAmnts16; TransAmnts[16])
            {
            }
            column(TransAmnts17; TransAmnts[17])
            {
            }
            column(TransAmnts18; TransAmnts[18])
            {
            }
            column(TransAmnts19; TransAmnts[19])
            {
            }
            column(TransAmnts20; TransAmnts[20])
            {
            }
            column(TransAmnts21; TransAmnts[21])
            {
            }
            column(TransTotals1; TransTotals[1])
            {
            }
            column(TransTotals2; TransTotals[2])
            {
            }
            column(TransTotals3; TransTotals[3])
            {
            }
            column(TransTotals4; TransTotals[4])
            {
            }
            column(TransTotals5; TransTotals[5])
            {
            }
            column(TransTotals6; TransTotals[6])
            {
            }
            column(TransTotals7; TransTotals[7])
            {
            }
            column(TransTotals8; TransTotals[8])
            {
            }
            column(TransTotals9; TransTotals[9])
            {
            }
            column(TransTotals10; TransTotals[10])
            {
            }
            column(TransTotals11; TransTotals[11])
            {
            }
            column(TransTotals12; TransTotals[12])
            {
            }
            column(TransTotals13; TransTotals[13])
            {
            }
            column(TransTotals14; TransTotals[14])
            {
            }
            column(TransTotals15; TransTotals[15])
            {
            }
            column(TransTotals16; TransTotals[16])
            {
            }
            column(TransTotals17; TransTotals[17])
            {
            }
            column(TransTotals18; TransTotals[18])
            {
            }
            column(TransTotals19; TransTotals[19])
            {
            }
            column(TransTotals20; TransTotals[20])
            {
            }
            column(TransTotals21; TransTotals[21])
            {
            }
            column(TransName1; TransName[1])
            {
            }
            column(TransName2; TransName[2])
            {
            }
            column(TransName3; TransName[3])
            {
            }
            column(TransName4; TransName[4])
            {
            }
            column(TransName5; TransName[5])
            {
            }
            column(TransName6; TransName[6])
            {
            }
            column(TransName7; TransName[7])
            {
            }
            column(TransName8; TransName[8])
            {
            }
            column(TransName9; TransName[9])
            {
            }
            column(TransName10; TransName[10])
            {
            }
            column(TransName11; TransName[11])
            {
            }
            column(TransName12; TransName[12])
            {
            }
            column(TransName13; TransName[13])
            {
            }
            column(TransName14; TransName[14])
            {
            }
            column(TransName15; TransName[15])
            {
            }
            column(TransName16; TransName[16])
            {
            }
            column(TransName17; TransName[17])
            {
            }
            column(TransName18; TransName[18])
            {
            }
            column(TransName19; TransName[19])
            {
            }
            column(TransName20; TransName[20])
            {
            }
            column(TransName21; TransName[21])
            {
            }
            column(Pic; CI.Picture)
            {
            }
            column(TransVisible1; TransVisible[1])
            {
            }
            column(TransVisible2; TransVisible[2])
            {
            }
            column(TransVisible3; TransVisible[3])
            {
            }
            column(TransVisible4; TransVisible[4])
            {
            }
            column(TransVisible5; TransVisible[5])
            {
            }
            column(TransVisible6; TransVisible[6])
            {
            }
            column(TransVisible7; TransVisible[7])
            {
            }
            column(TransVisible8; TransVisible[8])
            {
            }
            column(TransVisible9; TransVisible[9])
            {
            }
            column(TransVisible10; TransVisible[10])
            {
            }
            column(TransVisible11; TransVisible[11])
            {
            }
            column(TransVisible12; TransVisible[12])
            {
            }
            column(TransVisible13; TransVisible[13])
            {
            }
            column(TransVisible14; TransVisible[14])
            {
            }
            column(TransVisible15; TransVisible[15])
            {
            }
            column(TransVisible16; TransVisible[16])
            {
            }
            column(TransVisible17; TransVisible[17])
            {
            }
            column(TransVisible18; TransVisible[18])
            {
            }
            column(TransVisible19; TransVisible[19])
            {
            }
            column(TransVisible20; TransVisible[20])
            {
            }
            column(TransVisible21; TransVisible[21])
            {
            }
            column(period; period)
            {
            }
            column(pname; PeriodName)
            {
            }
            column(TransAmntsA1; TransAmntsA[1])
            {
            }
            column(TransAmntsA2; TransAmntsA[2])
            {
            }
            column(TransAmntsA3; TransAmntsA[3])
            {
            }
            column(TransAmntsA4; TransAmntsA[4])
            {
            }
            column(TransAmntsA5; TransAmntsA[5])
            {
            }
            column(TransAmntsA6; TransAmntsA[6])
            {
            }
            column(TransAmntsA7; TransAmntsA[7])
            {
            }
            column(TransAmntsA8; TransAmntsA[8])
            {
            }
            column(TransAmntsA9; TransAmntsA[9])
            {
            }
            column(TransAmntsA10; TransAmntsA[10])
            {
            }
            column(TransAmntsA11; TransAmntsA[11])
            {
            }
            column(TransAmntsA12; TransAmntsA[12])
            {
            }
            column(TransAmntsA13; TransAmntsA[13])
            {
            }
            column(TransAmntsA14; TransAmntsA[14])
            {
            }
            column(TransAmntsA15; TransAmntsA[15])
            {
            }
            column(TransAmntsA16; TransAmntsA[16])
            {
            }
            column(TransTotalsA1; TransTotalsA[1])
            {
            }
            column(TransTotalsA2; TransTotalsA[2])
            {
            }
            column(TransTotalsA3; TransTotalsA[3])
            {
            }
            column(TransTotalsA4; TransTotalsA[4])
            {
            }
            column(TransTotalsA5; TransTotalsA[5])
            {
            }
            column(TransTotalsA6; TransTotalsA[6])
            {
            }
            column(TransTotalsA7; TransTotalsA[7])
            {
            }
            column(TransTotalsA8; TransTotalsA[8])
            {
            }
            column(TransTotalsA9; TransTotalsA[9])
            {
            }
            column(TransTotalsA10; TransTotalsA[10])
            {
            }
            column(TransTotalsA11; TransTotalsA[11])
            {
            }
            column(TransTotalsA12; TransTotalsA[12])
            {
            }
            column(TransTotalsA13; TransTotalsA[13])
            {
            }
            column(TransTotalsA14; TransTotalsA[14])
            {
            }
            column(TransTotalsA15; TransTotalsA[15])
            {
            }
            column(TransTotalsA16; TransTotalsA[16])
            {
            }
            column(TransNameA1; TransNameA[1])
            {
            }
            column(TransNameA2; TransNameA[2])
            {
            }
            column(TransNameA3; TransNameA[3])
            {
            }
            column(TransNameA4; TransNameA[4])
            {
            }
            column(TransNameA5; TransNameA[5])
            {
            }
            column(TransNameA6; TransNameA[6])
            {
            }
            column(TransNameA7; TransNameA[7])
            {
            }
            column(TransNameA8; TransNameA[8])
            {
            }
            column(TransNameA9; TransNameA[9])
            {
            }
            column(TransNameA10; TransNameA[10])
            {
            }
            column(TransNameA11; TransNameA[11])
            {
            }
            column(TransNameA12; TransNameA[12])
            {
            }
            column(TransNameA13; TransNameA[13])
            {
            }
            column(TransNameA14; TransNameA[14])
            {
            }
            column(TransNameA15; TransNameA[15])
            {
            }
            column(TransNameA16; TransNameA[16])
            {
            }
            column(TransVisibleA1; TransVisibleA[1])
            {
            }
            column(TransVisibleA2; TransVisibleA[2])
            {
            }
            column(TransVisibleA3; TransVisibleA[3])
            {
            }
            column(TransVisibleA4; TransVisibleA[4])
            {
            }
            column(TransVisibleA5; TransVisibleA[5])
            {
            }
            column(TransVisibleA6; TransVisibleA[6])
            {
            }
            column(TransVisibleA7; TransVisibleA[7])
            {
            }
            column(TransVisibleA8; TransVisibleA[8])
            {
            }
            column(TransVisibleA9; TransVisibleA[9])
            {
            }
            column(TransVisibleA10; TransVisibleA[10])
            {
            }
            column(TransVisibleA11; TransVisibleA[11])
            {
            }
            column(TransVisibleA12; TransVisibleA[12])
            {
            }
            column(TransVisibleA13; TransVisibleA[13])
            {
            }
            column(TransVisibleA14; TransVisibleA[14])
            {
            }
            column(TransVisibleA15; TransVisibleA[15])
            {
            }
            column(TransVisibleA16; TransVisibleA[16])
            {
            }

            trigger OnAfterGetRecord()
            begin
                // IF ("Contract Type"= "Contract Type"::Board) OR ("Contract Type"="Contract Type"::Committee) OR (IsCommette=TRUE) OR (IsBoard=TRUE) THEN
                //CurrReport.SKIP;
                /* TransAmnts[1]:=0;TransAmntsA[1]:=0;
                 TransAmnts[2]:=0;TransAmntsA[2]:=0;
                 TransAmnts[3]:=0;TransAmntsA[3]:=0;
                 TransAmnts[4]:=0;TransAmntsA[4]:=0;
                 TransAmnts[5]:=0;TransAmntsA[5]:=0;
                 TransAmnts[6]:=0;TransAmntsA[6]:=0;
                 TransAmnts[7]:=0;TransAmntsA[7]:=0;
                 TransAmnts[8]:=0;TransAmntsA[8]:=0;
                 TransAmnts[9]:=0;TransAmntsA[9]:=0;
                 TransAmnts[10]:=0;TransAmntsA[10]:=0;
                 TransAmnts[11]:=0;TransAmntsA[11]:=0;
                 TransAmnts[12]:=0;TransAmntsA[12]:=0;
                 TransAmnts[13]:=0;TransAmntsA[13]:=0;
                 TransAmnts[14]:=0;TransAmntsA[14]:=0;
                 TransAmnts[15]:=0;TransAmntsA[15]:=0;
                 TransAmnts[16]:=0;TransAmntsA[16]:=0;
                 TransAmnts[17]:=0;
                 TransAmnts[18]:=0;
                 TransAmnts[19]:=0;
                 TransAmnts[20]:=0;
                 TransAmnts[21]:=0;

                 Name:=Customer.Name;
                { //Basic Pay
                 TransName[1]:='Basic Pay';
                 prPeriodTrans.RESET;
                 prPeriodTrans.SETRANGE(prPeriodTrans."Employee No.",Employee."No.");
                 prPeriodTrans.SETRANGE(prPeriodTrans."Payroll Period",period);
                 prPeriodTrans.SETRANGE(prPeriodTrans."Transaction Code",'BPAY');
                 IF prPeriodTrans.FINDFIRST THEN BEGIN
                   TransAmnts[1]:=prPeriodTrans.Amount;
                   TransTotals[1]:=TransTotals[1]+prPeriodTrans.Amount;
                 END;
                 TransVisible[1]:=FALSE;
                 {IF TransAmnts[1]=0 THEN
                   CurrReport.SKIP;}
                 //Gross Pay
                 TransName[16]:='Gross Pay/Topup';
                 prPeriodTrans.RESET;
                 prPeriodTrans.SETRANGE(prPeriodTrans."Employee No.",Employee."No.");
                 prPeriodTrans.SETRANGE(prPeriodTrans."Payroll Period",period);
                 prPeriodTrans.SETRANGE(prPeriodTrans."Transaction Code",'GPAY');
                 IF prPeriodTrans.FINDFIRST THEN BEGIN
                   TransAmnts[16]:=prPeriodTrans.Amount;
                   TransTotals[16]:=TransTotals[16]+prPeriodTrans.Amount;
                 END;
                 TransVisible[16]:=FALSE;

                 //Taxable Pay
                 TransName[17]:='Taxable Pay';
                 prPeriodTrans.RESET;
                 prPeriodTrans.SETRANGE(prPeriodTrans."Employee No.",Employee."No.");
                 prPeriodTrans.SETRANGE(prPeriodTrans."Payroll Period",period);
                 prPeriodTrans.SETRANGE(prPeriodTrans."Transaction Code",'TAXABLEPAY');
                 IF prPeriodTrans.FINDFIRST THEN BEGIN
                   TransAmnts[17]:=prPeriodTrans.Amount;
                   TransTotals[17]:=TransTotals[17]+prPeriodTrans.Amount;
                 END;
                 TransVisible[17]:=FALSE;

                 //PAYE
                 TransName[18]:='PAYE';
                 prPeriodTrans.RESET;
                 prPeriodTrans.SETRANGE(prPeriodTrans."Employee No.",Employee."No.");
                 prPeriodTrans.SETRANGE(prPeriodTrans."Payroll Period",period);
                 prPeriodTrans.SETRANGE(prPeriodTrans."Transaction Code",'PAYE');
                 IF prPeriodTrans.FINDFIRST THEN BEGIN
                   TransAmnts[18]:=prPeriodTrans.Amount;
                   TransTotals[18]:=TransTotals[18]+prPeriodTrans.Amount;
                 END;
                 TransVisible[18]:=FALSE;
                 //NSSF
                 TransName[19]:='NSSF';
                 prPeriodTrans.RESET;
                 prPeriodTrans.SETRANGE(prPeriodTrans."Employee No.",Employee."No.");
                 prPeriodTrans.SETRANGE(prPeriodTrans."Payroll Period",period);
                 prPeriodTrans.SETRANGE(prPeriodTrans."Transaction Code",'NSSF');
                 IF prPeriodTrans.FINDFIRST THEN BEGIN
                   TransAmnts[19]:=prPeriodTrans.Amount;
                   TransTotals[19]:=TransTotals[19]+prPeriodTrans.Amount;
                 END;
                 TransVisible[19]:=FALSE;
                 //NHIF
                 TransName[20]:='NHIF';
                 prPeriodTrans.RESET;
                 prPeriodTrans.SETRANGE(prPeriodTrans."Employee No.",Employee."No.");
                 prPeriodTrans.SETRANGE(prPeriodTrans."Payroll Period",period);
                 prPeriodTrans.SETRANGE(prPeriodTrans."Transaction Code",'NHIF');
                 IF prPeriodTrans.FINDFIRST THEN BEGIN
                   TransAmnts[20]:=prPeriodTrans.Amount;
                   TransTotals[20]:=TransTotals[20]+prPeriodTrans.Amount;
                 END;
                 TransVisible[20]:=FALSE;
                 //NetPay
                 TransName[21]:='Net Pay';
                 prPeriodTrans.RESET;
                 prPeriodTrans.SETRANGE(prPeriodTrans."Employee No.",Employee."No.");
                 prPeriodTrans.SETRANGE(prPeriodTrans."Payroll Period",period);
                 prPeriodTrans.SETRANGE(prPeriodTrans."Transaction Code",'NPAY');
                 IF prPeriodTrans.FINDFIRST THEN BEGIN
                   TransAmnts[21]:=prPeriodTrans.Amount;
                   TransTotals[21]:=TransTotals[21]+prPeriodTrans.Amount;
                 END;
                 TransVisible[21]:=FALSE;
                 }
                 //Allowances
                 CounterA:=1;
                 prTrans.RESET;
                // prTrans.SETRANGE(prTrans."Transaction Type",prTrans."Transaction Type"::"Cash Pay");
                // prTrans.SETFILTER(prTrans."Transaction Code",'E*');
                 IF prTrans.FINDSET THEN BEGIN
                  REPEAT
                   TransNameA[CounterA]:=prTrans.Name;
                   prPeriodTrans.RESET;
                   prPeriodTrans.SETRANGE(prPeriodTrans."Charge Code",prTrans.Code);
                   prPeriodTrans.SETRANGE(prPeriodTrans."Tenant No.",Customer."No.");
               //    prPeriodTrans.SETRANGE(prPeriodTrans."Payroll Period",period);
                   IF prPeriodTrans.FINDFIRST THEN BEGIN
                      TransAmntsA[CounterA]:=prPeriodTrans.Amount;
                     // IF prPeriodTrans."Posting Type"=prPeriodTrans."Posting Type"::Credit THEN
                       // TransAmntsA[CounterA]:=TransAmntsA[CounterA]*-1;
                   END;
                   TransVisibleA[CounterA]:=HasValue(prTrans.Code,period);
                   CounterA:=CounterA+1;
                  UNTIL prTrans.NEXT=0;
                 END;
                 //End Allowances

                { //Deductions
                 prTrans.RESET;
                 prTrans.SETRANGE(prTrans."Transaction Type",prTrans."Transaction Type"::"Cash Deduction");
                 prTrans.SETFILTER(prTrans."Transaction Code",'D*|A*');
                 IF prTrans.FINDSET THEN BEGIN
                  Counter:=2;
                  REPEAT
                   TransName[Counter]:=prTrans."Transaction Name";
                   prPeriodTrans.RESET;
                   prPeriodTrans.SETRANGE(prPeriodTrans."Transaction Code",prTrans."Transaction Code");
                   prPeriodTrans.SETRANGE(prPeriodTrans."Employee No.",Employee."No.");
                   prPeriodTrans.SETRANGE(prPeriodTrans."Payroll Period",period);
                   IF prPeriodTrans.FINDFIRST THEN BEGIN
                      TransAmnts[Counter]:=prPeriodTrans.Amount;
                      TransTotals[Counter]:=TransTotals[Counter]+prPeriodTrans.Amount;
                   END;
                   TransVisible[Counter]:=HasValue(prTrans."Transaction Code",period);
                   Counter:=Counter+1;
                  UNTIL prTrans.NEXT=0;
                 END;
                  //End Deductions
                  }
                  */

            end;

            trigger OnPreDataItem()
            begin
                c := 1;
                while c < 22 do begin
                    TransTotals[c] := 0;
                    c := c + 1;
                end;
            end;
        }
    }

    requestpage
    {

        layout
        {
            area(content)
            {
                field("Payroll Period"; period)
                {
                    TableRelation = "Payroll Period"."Date Opened";
                }
            }
        }

        actions
        {
        }
    }

    labels
    {
    }

    trigger OnPreReport()
    begin
        /* CI.GET;
         CI.CALCFIELDS(CI.Picture);
         IF period=0D THEN BEGIN
          ERROR('Please Select the Payroll Period');
         END;
         PrPeriod.RESET;
         PrPeriod.SETRANGE(PrPeriod."Date Opened",period);
         IF PrPeriod.FINDFIRST THEN BEGIN
            PeriodName:=PrPeriod."Period Name";
         END;
        TransVisible[1]:=TRUE;
        TransVisible[2]:=TRUE;
        TransVisible[3]:=TRUE;
        TransVisible[4]:=TRUE;
        TransVisible[5]:=TRUE;
        TransVisible[6]:=TRUE;
        TransVisible[7]:=TRUE;
        TransVisible[8]:=TRUE;
        TransVisible[9]:=TRUE;
        TransVisible[10]:=TRUE;
        TransVisible[11]:=TRUE;
        TransVisible[12]:=TRUE;
        TransVisible[13]:=TRUE;
        TransVisible[14]:=TRUE;
        TransVisible[15]:=TRUE;

        TransVisibleA[1]:=TRUE;
        TransVisibleA[2]:=TRUE;
        TransVisibleA[3]:=TRUE;
        TransVisibleA[4]:=TRUE;
        TransVisibleA[5]:=TRUE;
        TransVisibleA[6]:=TRUE;
        TransVisibleA[7]:=TRUE;
        TransVisibleA[8]:=TRUE;
        TransVisibleA[9]:=TRUE;
        TransVisibleA[10]:=TRUE;
        TransVisibleA[11]:=TRUE;
        TransVisibleA[12]:=TRUE;
        TransVisibleA[13]:=TRUE;
        TransVisibleA[14]:=TRUE;
        TransVisibleA[15]:=TRUE;
        TransVisibleA[16]:=TRUE;*/

    end;

    var
        Name: Text[50];
        TransAmnts: array[21] of Decimal;
        TransName: array[21] of Text[50];
        TransVisible: array[21] of Boolean;
        TransTotals: array[21] of Decimal;
        period: Date;
        Counter: Integer;
        BasicPay: Decimal;
        prSalary: Record "Cover Letter";
        CI: Record "Company Information";
        PrPeriod: Record "Payroll Period";
        PeriodName: Text[50];
        c: Integer;
        TransAmntsA: array[16] of Decimal;
        TransNameA: array[16] of Text[50];
        TransVisibleA: array[16] of Boolean;
        TransTotalsA: array[16] of Decimal;
        CounterA: Integer;

    local procedure HasValue(TransCode: Code[10]; Period: Date): Boolean
    var
        pTrans: Record "Employee Salary Ledger1";
        Amnt: Decimal;
    begin
        /* Amnt:=0;
         pTrans.RESET;
         pTrans.SETRANGE(pTrans."Payroll Period",Period);
         pTrans.SETRANGE(pTrans."Transaction Code",TransCode);
         IF pTrans.FINDSET THEN BEGIN
           REPEAT
             Amnt:=Amnt+pTrans.Amount;
           UNTIL pTrans.NEXT=0;
           IF Amnt<>0 THEN BEGIN
             EXIT(FALSE);
           END ELSE BEGIN
             EXIT(TRUE);
           END;
         END ELSE BEGIN
           EXIT(TRUE);
         END;*/

    end;
}

